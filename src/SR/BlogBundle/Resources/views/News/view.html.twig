{% extends "SRBlogBundle::layout.html.twig" %}

{% block content %}

	<h1>{{news.title}}</h1>
	<p>Par : {{news.user.username}} le {{news.newsDate|date("d/m/Y") }}</p>

	{% if news.image.id is defined %}
		<img  class="image_post"src="{{ asset(news.image.webPath| apply_filter('thumbnail_filter')) }}" alt="{{ news.image.alt }}"/>
	{% endif %}

	{{news.content| raw}}

	{% if is_granted('ROLE_MODERATEUR') %}
		<p><a href="javascript:;" data-target="#updateNewsModal"  data-toggle="modal" class="bouton">Modifier</a></p>
		<p><a href="javascript:;" data-target="#deleteNewsModal" data-toggle="modal" class="bouton2">Supprimer</a></p>
	{% endif %}

	{#BLOC COMMENTAIRE#}
	<br>
	{% include'SRBlogBundle:Comment:indexNews.html.twig' with { 'comments': comments }%}

	<h3>Ajouter un commentaire</h3>
	{% if is_granted('ROLE_USER') %}
		{% render(controller('SRBlogBundle:Comment:newNews', { 'news' : news } )) %}
	{% else %}
		<p>Vous devez être connecté pour laisser un commentaire.</p>
	{% endif %}

	{#MODAL MODIFIER ARTICLE#}
	<div class="modal fade" id="updateNewsModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"></div>
	{#MODAL SUPPRIMER CATEGORIE ARTICLE#}
	<div class="modal fade" id="deleteNewsModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"></div>

{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script>
		(function(){

			$("#updateNewsModal").on('show.bs.modal', function(e){
				$.ajax({
					url :  Routing.generate('sr_blog_article_update', {slug: '{{news.slug}}'} ),
					type : 'GET',
					success : function(html, statut){ // code_html contient le HTML renvoyé
						$("#updateNewsModal").html(html);
					},
					error : function(resultat, statut, erreur){
						console.log("La requète n'a pas abouti")
					}
				});
			});

			$("#deleteNewsModal").on('show.bs.modal', function(e){

				$.ajax({
					url :  Routing.generate('sr_blog_article_delete', {slug: '{{news.slug}}'} ),
					type : 'GET',
					success : function(html, statut){ // code_html contient le HTML renvoyé
						$("#deleteNewsModal").html(html);
					},
					error : function(resultat, statut, erreur){
						console.log("La requète n'a pas abouti")
					}
				});
			});

		})();

	</script>
{% endblock %}